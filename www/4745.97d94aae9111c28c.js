"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4745],{4745:(M,h,c)=>{c.r(h),c.d(h,{ChangePinPage:()=>O});var d=c(5861),s=c(95),i=c(8606),f=c(340),_=c(6814),t=c(6689),p=c(1725),C=c(1517);function P(u,v){if(1&u){const n=t.EpF();t.TgZ(0,"div")(1,"form",7)(2,"div",8)(3,"ion-item",9),t._UZ(4,"ion-input",10),t.qZA()(),t.TgZ(5,"div",8)(6,"ion-item",9),t._UZ(7,"ion-input",11),t.qZA()(),t.TgZ(8,"div",8)(9,"ion-item",9),t._UZ(10,"ion-input",12),t.qZA()()(),t._UZ(11,"ion-loading",13),t.TgZ(12,"div",14),t._UZ(13,"br")(14,"br"),t.TgZ(15,"ion-button",15),t.NdJ("click",function(){t.CHM(n);const o=t.oxw();return t.KtG(o.changeP())}),t.TgZ(16,"ion-text"),t._uU(17,"Save"),t.qZA()(),t._UZ(18,"br"),t.qZA()()}if(2&u){const n=t.oxw();t.xp6(1),t.Q6J("formGroup",n.form),t.xp6(3),t.Q6J("counter",!0)("counterFormatter",n.customCounterFormatterE),t.xp6(3),t.Q6J("counterFormatter",n.customCounterFormatterE),t.xp6(3),t.Q6J("counterFormatter",n.customCounterFormatterE),t.xp6(1),t.Q6J("message","Please wait...")("duration",1e4)("showBackdrop",!0)("translucent",!0)("spinner","crescent"),t.xp6(4),t.Q6J("disabled",n.form.invalid)}}let O=(()=>{class u{constructor(n,e,o,r,a,m,g,l){this.loadingCtrl=n,this.loadingCtl=e,this.router=o,this.toastController=r,this.modalCtrl=a,this.toastCtrl=m,this.authService=g,this.alertController=l,this.otpTime=60,this.otpDisabled=!1,this.resendTime=30,this.resendDisabled=!1,this.isLoading=!1,this.type=!0,this.verified=!1,this.showSpinner=!1,this.showOtpForm=!1,this.postData={fullname:"",tagname:"",phone:"",pin2:"",email:"",confirmpin2:""},this.initForm()}matchValues(n,e){return o=>{const a=o.controls.confirm_pin2;if(a.errors&&!a.errors.mustMatch)return null;a.setErrors(o.controls.pin2.value!==a.value?{mustMatch:!0}:null)}}customCounterFormatterE(n,e){return e-n+" characters remaining"}ngOnInit(){}initForm(){this.form=new s.cw({pin:new s.NI(null,{validators:[s.kI.required,s.kI.minLength(4)]}),confirm_pin2:new s.NI(null,{validators:[s.kI.required,this.matchingPasswords.bind(this)]}),pin2:new s.NI(null,{validators:[s.kI.required,s.kI.minLength(4)]})})}matchingPasswords(n){return this.form&&n.value!==this.form.controls.confirm_pin2.value?{mismatchedPasswords:!0}:null}goToLogin(){this.router.navigateByUrl("/auth-screen")}changeType(){this.type=!this.type}presentAlertx(n,e){var o=this;return(0,d.Z)(function*(){yield(yield o.alertController.create({header:"Velux Pay",subHeader:n,message:e,buttons:[{text:"OK",cssClass:"alert-button-confirm",handler:()=>{"Failed"!==n&&o.router.navigateByUrl("/tabs")}}],backdropDismiss:!1,cssClass:"custom-alert",animated:!0,mode:"ios",translucent:!0})).present()})()}presentLoading(n,e){var o=this;return(0,d.Z)(function*(){yield(yield o.loadingCtl.create({message:n,spinner:e})).present()})()}presentToast(n,e){var o=this;return(0,d.Z)(function*(){(yield o.toastCtrl.create({message:n,color:e,duration:1e3,position:"bottom"})).present()})()}changeNumber(n){const e=this.form.value.email;e&&e?.valid&&(this.verified=!(!this.verifiedEmail||e!=this.verifiedEmail))}changeP(){var n=this;return(0,d.Z)(function*(){const e=yield n.loadingCtrl.create({message:"Please wait..."});if(yield e.present(),n.presentLoading("Validating...","circular"),n.form.valid){const o={oldtransferPin:n.form.get("pin").value,confirm_newtransferPin:n.form.get("confirm_pin2").value,newtransferPin:n.form.get("pin2").value},r=n.form.get("pin").value;if(4===r.length){console.log(r);const a={transferPin:r};console.log("I am "+a),n.authService.checkPin(a).subscribe(function(){var m=(0,d.Z)(function*(g){console.log(g),"Signature verification failed"===g.message&&"/auth-screen"!==n.router.url?(localStorage.removeItem("userData"),localStorage.removeItem("res"),localStorage.removeItem("accessT"),n.toastController.create(),n.presentToast("Session Expired.....Logging out","danger"),n.router.navigateByUrl("/auth-screen"),n.loadingCtl.dismiss()):("correct pin"===g?(n.loadingCtl.dismiss(),n.hideLoader(),n.modalCtrl.dismiss(g),n.presentLoading("Processing...","circular"),console.log(o),n.authService.changePin(o).subscribe(l=>{console.log(JSON.stringify(l)),"Signature verification failed"===l.message&&"/auth-screen"!==n.router.url?(localStorage.removeItem("userData"),localStorage.removeItem("res"),localStorage.removeItem("accessT"),n.toastController.create(),n.presentToast("Session Expired.....Logging out","danger"),n.router.navigateByUrl("/auth-screen"),n.loadingCtl.dismiss()):!1===l.status?(n.toastController.create(),n.presentToast(l+", Please try again","danger"),n.presentAlertx("Failed","Error occured!"),n.loadingCtl.dismiss()):(n.toastController.create(),n.presentToast(l,"success"),n.presentAlertx("Success","Pin changed Sucessfully!"),console.log("I got here"),n.loadingCtl.dismiss())},l=>{console.error(l),console.log("Error found here"),n.loadingCtl.dismiss()}),n.loadingCtl.dismiss()):((yield n.toastCtrl.create({message:"Invalid User Pin. Please try again.",duration:2e3,position:"bottom",color:"danger"})).present(),n.hideLoader(),n.modalCtrl.dismiss(a),n.loadingCtl.dismiss()),n.loadingCtl.dismiss())});return function(g){return m.apply(this,arguments)}}(),function(){var m=(0,d.Z)(function*(g){console.log(g),(yield n.toastCtrl.create({message:"Invalid User Pin. Please try again.",duration:2e3,position:"bottom",color:"danger"})).present(),n.hideLoader(),n.modalCtrl.dismiss(a),n.loadingCtl.dismiss()});return function(g){return m.apply(this,arguments)}}())}console.log(o),console.log("I got Here")}yield e.dismiss()})()}showLoader(n){return this.isLoading||(this.isLoading=!0),this.loadingCtrl.create({message:n,spinner:"bubbles"}).then(e=>{e.present().then(()=>{this.isLoading||e.dismiss().then(()=>{console.log("abort presenting")})})}).catch(e=>{this.isLoading=!1,console.log(e)})}hideLoader(){return this.isLoading&&(this.isLoading=!1),this.loadingCtrl.dismiss().then(()=>console.log("dismissed")).catch(n=>console.log(n))}showToastx(n){var e=this;return(0,d.Z)(function*(){(yield e.toastCtrl.create({message:n,duration:2e3,color:"success"})).present()})()}onVerifyOTP(){var n=this;if(this.showLoader("Verifying..."),this.otpForm.valid){const e={...this.form.value,...this.otpForm.value};this.authService.verifyOTP(e).subscribe(function(){var o=(0,d.Z)(function*(r){console.log(r),"account activated successfully"===r.status&&(yield n.toastCtrl.create({message:"OTP verified successfully.",duration:3e3,position:"bottom"})).present(),n.hideLoader(),n.modalCtrl.dismiss(r),n.showToastx(r.status),n.router.navigateByUrl("/register/verify")});return function(r){return o.apply(this,arguments)}}(),function(){var o=(0,d.Z)(function*(r){console.log(r),(yield n.toastCtrl.create({message:"Invalid OTP. Please try again.",duration:2e3,position:"middle",color:"danger"})).present(),n.router.navigateByUrl("/tabs"),n.hideLoader(),n.modalCtrl.dismiss(e)});return function(r){return o.apply(this,arguments)}}())}}resendOTP(){console.log("Resending OTP to:",this.form.get("email").value),this.startResendTimer()}startResendTimer(){this.resendDisabled=!0,this.resendSubscription=(0,f.F)(1e3).subscribe(()=>{this.resendTime--,0===this.resendTime&&(this.resendSubscription.unsubscribe(),this.resendDisabled=!1,this.resendTime=30)})}ngOnDestroy(){this.resendSubscription&&this.resendSubscription.unsubscribe(),this.otpSubscription&&this.otpSubscription.unsubscribe()}static#n=this.\u0275fac=function(e){return new(e||u)(t.Y36(i.HT),t.Y36(i.HT),t.Y36(p.F0),t.Y36(i.yF),t.Y36(i.IN),t.Y36(i.yF),t.Y36(C.e),t.Y36(i.Br))};static#t=this.\u0275cmp=t.Xpm({type:u,selectors:[["app-change-pin"]],standalone:!0,features:[t.jDz],decls:13,vars:1,consts:[["slot","start"],["defaultHref","profiles/security"],["mode","ios"],["expand","block","color","secondary",1,"ion-padding"],[1,"ion-no-margin"],["lines","full"],[4,"ngIf"],[3,"formGroup"],[1,"ion-margin-vertical"],["lines","none"],["label","Pin*","label-placement","floating","minlength","4","errorText","* Entry not valid","formControlName","pin","placeholder","Default pin from email","type","password",3,"counter","counterFormatter"],["label","New Pin*","label-placement","floating","maxlength","4","minlength","4","errorText","* Entry not valid","formControlName","pin2","type","password",3,"counterFormatter"],["label","Confirm Pin*","label-placement","floating","maxlength","4","minlength","4","errorText","* Entry do not match","formControlName","confirm_pin2","type","password",3,"counterFormatter"],[3,"message","duration","showBackdrop","translucent","spinner"],[1,"purr"],["type","submit","size","large","expand","block","shape","round","color","warning",1,"ion-margin",3,"disabled","click"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title",2),t._uU(5,"Change Pin"),t.qZA()()(),t.TgZ(6,"ion-content")(7,"ion-button",3),t._uU(8," set a new Pin "),t.qZA(),t.TgZ(9,"ion-card",4)(10,"ion-card-content")(11,"ion-list",5),t.YNc(12,P,19,11,"div",6),t.qZA()()()()),2&e&&(t.xp6(12),t.Q6J("ngIf",!o.showOtpForm))},dependencies:[_.ez,_.O5,s.u5,s._Y,s.JJ,s.JL,s.wO,s.nD,s.UX,s.sg,s.u,i.Pc,i.YG,i.Sm,i.PM,i.FN,i.W2,i.Gu,i.pK,i.Ie,i.q_,i.wh,i.yW,i.wd,i.sr,i.j9,i.oU],styles:["ion-card[_ngcontent-%COMP%]{box-shadow:none!important;padding-top:3vh}ion-card[_ngcontent-%COMP%]   .otpForm[_ngcontent-%COMP%]{height:100%;padding-bottom:45vh}ion-card[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{font-size:.9rem}ion-card[_ngcontent-%COMP%]   ion-item.invalid[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{--border-color: var(--ion-color-danger)}ion-card[_ngcontent-%COMP%]   ion-item.valid[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{--border-color: var(--ion-color-success)}ion-card[_ngcontent-%COMP%]   .validation-message[_ngcontent-%COMP%]{font-size:.8rem;color:var(--ion-color-danger);margin-top:.2rem}ion-card[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{font-size:13px;color:#ff4500}ion-card[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;font-family:Irish Grover;font-style:normal;font-weight:700;font-size:24px;color:#9f27ca}ion-card[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{text-align:center;font-family:Irish Grover;font-style:normal;font-weight:700;font-size:34px;color:#9f27ca}ion-card[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{font-family:Inter;font-style:normal;font-weight:600;font-size:15px;line-height:18px}ion-card[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: transparent}ion-card[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], ion-card[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:700;letter-spacing:.8px}ion-card[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]{background:transparent;display:block}ion-card[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]   ion-fab-button[_ngcontent-%COMP%]{margin-right:2.5vh}ion-card[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]{border-radius:20px 20px 0 0}ion-card[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-list-header[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-weight:700;font-size:1.8em}ion-card[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%], ion-card[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{font-size:.9em}ion-card[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{font-size:.75em!important}ion-card[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-top:1.5vh;margin-bottom:3px}ion-card[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{box-shadow:0 4px 8px #0000001a;color:var(--ion-color-white);transform:translateZ(0);transition:box-shadow .3s,transform .3s}ion-card[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]:hover{box-shadow:0 8px 16px #0003;transform:translate3d(0,-2px,0);color:var(--ion-color-white)}ion-card[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]   #otp[_ngcontent-%COMP%]{margin-top:3vh;margin-bottom:5px}ion-footer[_ngcontent-%COMP%]{height:88%}ion-footer[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]{height:100%;border-radius:20px 20px 0 0}ion-footer[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-list-header[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-weight:700;font-size:1.8em}ion-footer[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:.9em;overflow:visible}ion-footer[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{font-size:1.5em;display:inline-block;width:8vh;height:8vh;border-radius:5px}ion-footer[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]   .marginLeft[_ngcontent-%COMP%]{margin-left:3vh}"]})}return u})()}}]);